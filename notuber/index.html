<!DOCTYPE html>

<html>

  <head>
    <title>{NotUber}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDwfO3Kf3o6Za1tJRSFA6sjEYoRCYXatlM&callback=getMyLocation"
    async defer></script>
    <!-- <script src="https://maps.googleapis.com/maps/api/js?libraries=geometry"
    async defer></script> -->

    <link rel="stylesheet" href="style.css"/>
    <script>

       var username = "cKkHI7M4Ux";
       var me;
       var map;
       myOptions = {
          zoom: 13,
          center: me,
          mapTypeId: google.maps.MapTypeId.ROADMAP
          };

      function getMyLocation()
        {
          if (navigator.geolocation)
            { 
              navigator.geolocation.getCurrentPosition(function(position) {
                myLat = position.coords.latitude;
                myLng = position.coords.longitude;

                me = new google.maps.LatLng(myLat, myLng);
                
                initMap();
                //requestData();
              });
            }

            else 
            {
              document.getElementById("map_canvas").innerHTML = "Geolocation disabled :(";
            }
        }

      //function to initialize map
      function initMap()
        {   
            // Create the map in the "map_canvas" <div>
            map = new google.maps.Map(document.getElementById("map_canvas"));
            map.setCenter(me);
            map.setZoom(15);
            setMarker();
        }

      function setMarker()
        {
          var marker = new google.maps.Marker({
            position: me,
            title: "Me",
            icon: url="spiderman.png",
            animation: google.maps.Animation.DROP,
          });
          
          marker.setMap(map);
          
          //global info window
          var infowindow = new google.maps.InfoWindow();
          
          // Open info window on click of marker
          google.maps.event.addListener(marker, 'click', function() {
            infowindow.setContent(marker.title);
            infowindow.open(map, marker);
          });
          requestData();
        }

      function requestData()
        {
          var request = new XMLHttpRequest();

          request.open('POST', "https://jordan-marsh.herokuapp.com/rides", true);
          console.log("data sent, post good")

          request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

          request.onload = function () 
          {
              data = JSON.parse(this.responseText);
              if(data["vehicles"])
              {
                vehicles(data, username)
              }

              else if(data["passengers"])
              {
                passengers(data, username)
              }
          };

          request.send("username=" + username + "&lat=" + myLat + "&lng=" + myLng);
          console.log("data sent")
        }


    </script>
  </head>
  
  <body>
    <h1>NotUber</h1>
    <div id="map_canvas"></div>
  </body>
</html>